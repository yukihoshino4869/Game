
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>優輝のジャンプゲーム（修正版）</title>
  <style>
    body { margin: 0; background: #cceeff; overflow: hidden; }
    #game {
      position: relative;
      width: 800px;
      height: 300px;
      margin: auto;
      overflow: hidden;
      background: #ccff99;
    }
    #world {
      position: absolute;
      width: 2400px;
      height: 300px;
      left: 0;
      top: 0;
    }
    #player {
      width: 30px;
      height: 30px;
      background: red;
      position: absolute;
      left: 50px;
      bottom: 30px;
    }
    #ground {
      position: absolute;
      bottom: 0;
      height: 30px;
      width: 100%;
      background: #654321;
    }
    .enemy {
      width: 30px;
      height: 30px;
      background: black;
      position: absolute;
      bottom: 30px;
    }
    .bullet {
      width: 10px;
      height: 10px;
      background: yellow;
      position: absolute;
    }
    #gameOver {
      position: absolute;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      color: white;
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      font-size: 28px;
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="world">
      <div id="player"></div>
      <div class="enemy" style="left: 1000px;"></div>
      <div class="enemy" style="left: 1600px;"></div>
      <div id="ground"></div>
    </div>
    <div id="gameOver">
      Game Over<br>Press Enter to Restart
    </div>
  </div>

<script>
  let gameRunning = true;
  const game = document.getElementById("game");
  const world = document.getElementById("world");
  const player = document.getElementById("player");
  const gameOverScreen = document.getElementById("gameOver");
  const gravity = 0.6;
  let posX = 50, posY = 0, velocityY = 0;
  let isJumping = false;
  const keys = {};
  let bullets = [];
  let enemies = [];

  document.addEventListener("keydown", e => {
    keys[e.key.toLowerCase()] = true;
    if (!gameRunning && e.key === "Enter") restartGame();
  });
  document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

  function shoot() {
    const bullet = document.createElement("div");
    bullet.className = "bullet";
    bullet.style.left = (posX + 30) + "px";
    bullet.style.bottom = (30 + posY + 10) + "px";
    world.appendChild(bullet);
    bullets.push({ el: bullet, x: posX + 30, y: posY + 30 });
  }

  function showGameOver() {
    gameOverScreen.style.display = "flex";
    gameRunning = false;
  }

  function restartGame() {
    bullets.forEach(b => b.el.remove());
    bullets = [];
    document.querySelectorAll(".enemy").forEach(e => e.remove());
    enemies = [];

    createEnemy(1000);
    createEnemy(1600);

    posX = 50; posY = 0; velocityY = 0; isJumping = false;
    gameOverScreen.style.display = "none";
    gameRunning = true;
    requestAnimationFrame(update);
  }

  function createEnemy(x) {
    const e = document.createElement("div");
    e.className = "enemy";
    e.style.left = x + "px";
    world.appendChild(e);
    enemies.push(e);
  }

  function update() {
    if (!gameRunning) return;

    // キー操作
    if (keys["a"]) posX -= 5;
    if (keys["d"]) posX += 5;
    if (keys["w"] && !isJumping) {
      velocityY = 10; // 修正：ジャンプ初速はプラス
      isJumping = true;
    }
    if (keys[" "] && bullets.length < 5) {
      shoot();
    }

    velocityY -= gravity; // 修正：上昇後に重力で落ちるようにする
    posY += velocityY;

    if (posY <= 0) {
      posY = 0;
      velocityY = 0;
      isJumping = false;
    }

    const scrollX = Math.min(Math.max(posX - 400, 0), 1600);
    world.style.left = -scrollX + "px";

    player.style.left = posX + "px";
    player.style.bottom = (30 + posY) + "px";

    // 弾の処理
    bullets = bullets.filter((b) => {
      b.x += 10;
      b.el.style.left = b.x + "px";

      let hit = false;
      enemies.forEach((enemy, i) => {
        const ex = parseInt(enemy.style.left);
        if (b.x > ex && b.x < ex + 30 && b.y < 60) {
          world.removeChild(enemy);
          enemies.splice(i, 1);
          hit = true;
        }
      });

      if (hit || b.x > 2400) {
        b.el.remove();
        return false;
      }
      return true;
    });

    // プレイヤーと敵の当たり判定
    enemies.forEach(enemy => {
      const ex = parseInt(enemy.style.left);
      if (posX + 30 > ex && posX < ex + 30 && posY < 30) {
        showGameOver();
      }
    });

    requestAnimationFrame(update);
  }

  restartGame();
</script>
</body>
</html>
